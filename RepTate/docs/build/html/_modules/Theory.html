

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Theory &#8212; RepTate 0.9.7 20200117 documentation</title>
    <link rel="stylesheet" href="../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/bizstyle.js"></script>
    <link rel="shortcut icon" href="../_static/Reptate64.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">RepTate 0.9.7 20200117 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/RepTatelogo.jpg" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for Theory</h1><div class="highlight"><pre>
<span></span><span class="c1"># RepTate: Rheology of Entangled Polymers: Toolkit for the Analysis of Theory and Experiments</span>
<span class="c1"># --------------------------------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Authors:</span>
<span class="c1">#     Jorge Ramirez, jorge.ramirez@upm.es</span>
<span class="c1">#     Victor Boudara, victor.boudara@gmail.com</span>
<span class="c1">#</span>
<span class="c1"># Useful links:</span>
<span class="c1">#     http://blogs.upm.es/compsoftmatter/software/reptate/</span>
<span class="c1">#     https://github.com/jorge-ramirez-upm/RepTate</span>
<span class="c1">#     http://reptate.readthedocs.io</span>
<span class="c1">#</span>
<span class="c1"># --------------------------------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Copyright (2017-2020): Jorge Ramirez, Victor Boudara, Universidad Polit√©cnica de Madrid, University of Leeds</span>
<span class="c1">#</span>
<span class="c1"># This file is part of RepTate.</span>
<span class="c1">#</span>
<span class="c1"># RepTate is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># RepTate is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with RepTate.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">#</span>
<span class="c1"># --------------------------------------------------------------------------------------------------------</span>
<span class="sd">&quot;&quot;&quot;Module Theory</span>

<span class="sd">Module that defines the basic structure and properties of a theory.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">enum</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">curve_fit</span><span class="p">,</span> <span class="n">basinhopping</span><span class="p">,</span> <span class="n">dual_annealing</span><span class="p">,</span> <span class="n">differential_evolution</span><span class="p">,</span> <span class="n">shgo</span><span class="p">,</span> <span class="n">brute</span>
<span class="kn">from</span> <span class="nn">scipy.stats.distributions</span> <span class="k">import</span> <span class="n">t</span>

<span class="kn">from</span> <span class="nn">CmdBase</span> <span class="k">import</span> <span class="n">CmdBase</span><span class="p">,</span> <span class="n">CmdMode</span>
<span class="kn">from</span> <span class="nn">DataTable</span> <span class="k">import</span> <span class="n">DataTable</span>
<span class="kn">from</span> <span class="nn">Parameter</span> <span class="k">import</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">ParameterType</span><span class="p">,</span> <span class="n">OptType</span>
<span class="kn">from</span> <span class="nn">DraggableArtists</span> <span class="k">import</span> <span class="n">DraggableVLine</span><span class="p">,</span> <span class="n">DraggableHLine</span><span class="p">,</span> <span class="n">DragType</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="k">import</span> <span class="n">QTextCursor</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="k">import</span> <span class="n">pyqtSignal</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QMessageBox</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">ToolMaterialsDatabase</span> <span class="k">import</span> <span class="n">check_chemistry</span><span class="p">,</span> <span class="n">get_all_parameters</span>

<span class="kn">from</span> <span class="nn">html.parser</span> <span class="k">import</span> <span class="n">HTMLParser</span>
<div class="viewcode-block" id="MLStripper"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.MLStripper">[docs]</a><span class="k">class</span> <span class="nc">MLStripper</span><span class="p">(</span><span class="n">HTMLParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove HTML tags from string&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strict</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_charrefs</span><span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fed</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="MLStripper.handle_data"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.MLStripper.handle_data">[docs]</a>    <span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MLStripper.get_data"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.MLStripper.get_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fed</span><span class="p">)</span></div></div>
        
<div class="viewcode-block" id="MinimizationMethod"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.MinimizationMethod">[docs]</a><span class="k">class</span> <span class="nc">MinimizationMethod</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Method used during minimization</span>
<span class="sd">    </span>
<span class="sd">    Parameters can be:</span>
<span class="sd">        - ls: Non-linear Least Squares (default)</span>
<span class="sd">        - basinhopping: Basin-hopping method</span>
<span class="sd">        - dualannealing: Dual-Annealing method</span>
<span class="sd">        - diffevol: Differential Evolution method</span>
<span class="sd">        - SHGO: simplicial homology global optimization</span>
<span class="sd">        - bruteforce: Find the minimum on a hypergrid</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ls</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">basinhopping</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">dualannealing</span><span class="o">=</span><span class="mi">2</span>
    <span class="n">diffevol</span><span class="o">=</span><span class="mi">3</span>
    <span class="n">SHGO</span><span class="o">=</span><span class="mi">4</span>
    <span class="n">bruteforce</span><span class="o">=</span><span class="mi">5</span></div>

<div class="viewcode-block" id="ErrorCalculationMethod"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.ErrorCalculationMethod">[docs]</a><span class="k">class</span> <span class="nc">ErrorCalculationMethod</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Method to determine the error of a theory calculation.</span>
<span class="sd">    </span>
<span class="sd">    Options are:</span>
<span class="sd">        - View1: Use current view number 1 in the application.</span>
<span class="sd">        - RawData: Use the data table as defined by the application.</span>
<span class="sd">        - AllViews: Use all active views.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">View1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">RawData</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">AllViews</span> <span class="o">=</span> <span class="mi">2</span></div>

<div class="viewcode-block" id="EndComputationRequested"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.EndComputationRequested">[docs]</a><span class="k">class</span> <span class="nc">EndComputationRequested</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception class to end computations&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="Theory"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory">[docs]</a><span class="k">class</span> <span class="nc">Theory</span><span class="p">(</span><span class="n">CmdBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract class to describe a theory</span>
<span class="sd">    </span>
<span class="sd">    [description]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">thname</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="sd">&quot;&quot;&quot; thname {str} -- Theory name &quot;&quot;&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="sd">&quot;&quot;&quot; description {str} -- Description of theory &quot;&quot;&quot;</span>
    <span class="n">citations</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="sd">&quot;&quot;&quot; citations {str} -- Articles that should be cited &quot;&quot;&quot;</span>
    <span class="n">doi</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="sd">&quot;&quot;&quot; doicode {str} -- Doi code of the article &quot;&quot;&quot;</span>
    <span class="n">nfev</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="sd">&quot;&quot;&quot; nfev {int} -- Number of function evaluations &quot;&quot;&quot;</span>

    <span class="n">print_signal</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Theory&quot;</span><span class="p">,</span> <span class="n">parent_dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axarr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Constructor**</span>
<span class="sd">        </span>
<span class="sd">        The following variables should be set by the particular realization of the theory:</span>
<span class="sd">            - parameters     (dict): Parameters of the theory</span>
<span class="sd">            - function       (func): Function that calculates the theory</span>
<span class="sd">            - min            (real): min for integration/calculation</span>
<span class="sd">            - max            (real): max</span>
<span class="sd">            - npoints         (int): Number of points to calculate</span>
<span class="sd">            - point_distribution   : all_points, linear, log</span>
<span class="sd">            - dt             (real): default time step</span>
<span class="sd">            - dt_min         (real): minimum time step for adaptive algorithms</span>
<span class="sd">            - eps            (real): precision for adaptive algorithms</span>
<span class="sd">            - integration_method   : Euler, RungeKutta5, AdaptiveDt</span>
<span class="sd">            - stop_steady    (bool): Stop calculation if steady state of component 0 is attained</span>
<span class="sd">        </span>
<span class="sd">        Keyword Arguments:</span>
<span class="sd">            - name {str} -- Name of theory (default: {&quot;Theory&quot;})</span>
<span class="sd">            - parent_dataset {DataSet} -- DataSet that contains the Theory (default: {None})</span>
<span class="sd">            - ax {matplotlib axes} -- matplotlib graph (default: {None})</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span> <span class="o">=</span> <span class="n">parent_dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axarr</span> <span class="o">=</span> <span class="n">axarr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1">#theory calculation only on this plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span>
        <span class="p">)</span>  <span class="c1"># keep the dictionary key in order for the parameter table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1">#defines if the theory is plotted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_is_busy</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autocalculate</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra_data</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Dictionary saved during &quot;Save Project&quot;</span>

        <span class="c1"># THEORY OPTIONS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npoints</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="mf">0.001</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt_min</span> <span class="o">=</span> <span class="mf">1e-6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_steady</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_fitting</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_modes</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span>

        <span class="c1"># XRANGE for FIT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrange</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xminline</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
            <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmaxline</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
            <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xminlinedrag</span> <span class="o">=</span> <span class="n">DraggableVLine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xminline</span><span class="p">,</span> <span class="n">DragType</span><span class="o">.</span><span class="n">horizontal</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">change_xmin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmaxlinedrag</span> <span class="o">=</span> <span class="n">DraggableVLine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmaxline</span><span class="p">,</span> <span class="n">DragType</span><span class="o">.</span><span class="n">horizontal</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">change_xmax</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_xrange_visible</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># YRANGE for FIT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yrange</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axhspan</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yminline</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
            <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymaxline</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
            <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yminlinedrag</span> <span class="o">=</span> <span class="n">DraggableHLine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yminline</span><span class="p">,</span> <span class="n">DragType</span><span class="o">.</span><span class="n">vertical</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">change_ymin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymaxlinedrag</span> <span class="o">=</span> <span class="n">DraggableHLine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymaxline</span><span class="p">,</span> <span class="n">DragType</span><span class="o">.</span><span class="n">vertical</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">change_ymax</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_yrange_visible</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_default_minimization_options</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_default_error_calculation_options</span><span class="p">()</span>

        <span class="c1"># Pre-create as many tables as files in the dataset</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">parent_dataset</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">file_name_short</span><span class="p">]</span> <span class="o">=</span> <span class="n">DataTable</span><span class="p">(</span>
                <span class="n">axarr</span><span class="p">,</span> <span class="s2">&quot;TH-&quot;</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">file_name_short</span><span class="p">)</span>
            <span class="c1">#initiallize theory table: important for &#39;single_file&#39; theories</span>
            <span class="n">ft</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">data_table</span>
            <span class="n">tt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">file_name_short</span><span class="p">]</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">num_columns</span> <span class="o">=</span> <span class="n">ft</span><span class="o">.</span><span class="n">num_columns</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">=</span> <span class="n">ft</span><span class="o">.</span><span class="n">num_rows</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">tt</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">num_columns</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">do_cite</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">CmdBase</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">CmdMode</span><span class="o">.</span><span class="n">GUI</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">print_qtextbox</span><span class="p">)</span>  <span class="c1"># Asynchronous print when using multithread</span>
         <span class="c1"># flag for requesting end of computations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_theory_flag</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="Theory.setup_default_minimization_options"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.setup_default_minimization_options">[docs]</a>    <span class="k">def</span> <span class="nf">setup_default_minimization_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># MINIMIZATION OPTIONS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mintype</span><span class="o">=</span><span class="n">MinimizationMethod</span><span class="o">.</span><span class="n">ls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LSmethod</span><span class="o">=</span><span class="s1">&#39;trf&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LSjac</span><span class="o">=</span><span class="s1">&#39;2-point&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LSftol</span><span class="o">=</span><span class="mf">1e-8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LSxtol</span><span class="o">=</span><span class="mf">1e-8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LSgtol</span><span class="o">=</span><span class="mf">1e-8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LSloss</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">LSf_scale</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LSmax_fnev</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LStr_solver</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basinniter</span><span class="o">=</span><span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basinT</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basinstepsize</span><span class="o">=</span><span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basininterval</span><span class="o">=</span><span class="mi">50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basinniter_success</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basinseed</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annealmaxiter</span><span class="o">=</span><span class="mi">1000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annealinitial_temp</span><span class="o">=</span><span class="mf">5230.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annealrestart_temp_ratio</span><span class="o">=</span><span class="mf">2e-5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annealvisit</span><span class="o">=</span><span class="mf">2.62</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annealaccept</span><span class="o">=-</span><span class="mf">5.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annealmaxfun</span><span class="o">=</span><span class="mi">10000000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annealseed</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annealno_local_search</span><span class="o">=</span><span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diffevolstrategy</span><span class="o">=</span><span class="s1">&#39;best1bin&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diffevolmaxiter</span><span class="o">=</span><span class="mi">1000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diffevolpopsize</span><span class="o">=</span><span class="mi">15</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diffevoltol</span><span class="o">=</span><span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diffevolmutation</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diffevolrecombination</span><span class="o">=</span><span class="mf">0.7</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diffevolseed</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diffevolpolish</span><span class="o">=</span><span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diffevolinit</span><span class="o">=</span><span class="s1">&#39;latinhypercube&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diffevolatol</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diffevolupdating</span><span class="o">=</span><span class="s1">&#39;immediate&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SHGOn</span><span class="o">=</span><span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SHGOiters</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SHGOmaxfev</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SHGOf_min</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SHGOf_tol</span><span class="o">=</span><span class="mf">1e-4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SHGOmaxiter</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SHGOmaxev</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SHGOmaxtime</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SHGOminhgrd</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SHGOminimize_every_iter</span><span class="o">=</span><span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SHGOlocal_iter</span><span class="o">=</span><span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SHGOinfty_constraints</span><span class="o">=</span><span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SHGOsampling_method</span><span class="o">=</span><span class="s1">&#39;simplicial&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BruteNs</span><span class="o">=</span><span class="mi">20</span></div>

<div class="viewcode-block" id="Theory.setup_default_error_calculation_options"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.setup_default_error_calculation_options">[docs]</a>    <span class="k">def</span> <span class="nf">setup_default_error_calculation_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errormethod</span> <span class="o">=</span> <span class="n">ErrorCalculationMethod</span><span class="o">.</span><span class="n">View1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalizebydata</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Theory.destructor"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.destructor">[docs]</a>    <span class="k">def</span> <span class="nf">destructor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Theory.precmd"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.precmd">[docs]</a>    <span class="k">def</span> <span class="nf">precmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculations before the theory is calculated</span>
<span class="sd">        </span>
<span class="sd">        This function could be erased</span>
<span class="sd">        This method is called after the line has been input but before</span>
<span class="sd">        it has been interpreted. If you want to modifdy the input line</span>
<span class="sd">        before execution (for example, variable substitution) do it here.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - line {[type]} -- [description]</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            - [type] -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Theory</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">precmd</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="Theory.update_parameter_table"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.update_parameter_table">[docs]</a>    <span class="k">def</span> <span class="nf">update_parameter_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Added so that Maxwell modes works in CL</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>
<div class="viewcode-block" id="Theory.handle_actionCalculate_Theory"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.handle_actionCalculate_Theory">[docs]</a>    <span class="k">def</span> <span class="nf">handle_actionCalculate_Theory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Used only in non GUI mode&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_calculate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theory.request_stop_computations"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.request_stop_computations">[docs]</a>    <span class="k">def</span> <span class="nf">request_stop_computations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called when user wants to terminate the current computation&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s1">&#39;&lt;font color=red&gt;&lt;b&gt;Stop current calculation requested&lt;/b&gt;&lt;/font&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_theory_flag</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Theory.do_calculate"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.do_calculate">[docs]</a>    <span class="k">def</span> <span class="nf">do_calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the theory&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_is_busy</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_is_busy</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time_cal</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">th_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theory_files</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">th_files</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_theory_flag</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">with_extra_x</span><span class="p">:</span>
                    <span class="n">data_copy</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">extend_xrange</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">with_extra_x</span><span class="p">:</span>
                    <span class="c1"># restore f</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data_copy</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">=</span> <span class="n">data_copy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_file</span><span class="p">:</span>
                <span class="c1"># delete theory data of other files</span>
                <span class="n">tt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">file_name_short</span><span class="p">]</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">tt</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">num_columns</span><span class="p">))</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fitting</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_plot</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_error</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;&lt;i&gt;---Calculated in </span><span class="si">%.3g</span><span class="s1"> seconds---&lt;/i&gt;&lt;br&gt;&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time_cal</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_cite</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_is_busy</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Theory.extend_xrange"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.extend_xrange">[docs]</a>    <span class="k">def</span> <span class="nf">extend_xrange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fcopy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extend the xrange of the fcopy data&quot;&quot;&quot;</span>
        <span class="c1"># xmin/xmax of current data</span>
        <span class="n">ncol</span> <span class="o">=</span> <span class="n">fcopy</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">fcopy</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">fcopy</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">thmin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fcopy</span><span class="o">.</span><span class="n">theory_xmin</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">fcopy</span><span class="o">.</span><span class="n">nextramin</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># number of extra rows added left</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">thmin</span> <span class="o">&lt;</span> <span class="n">xmin</span><span class="p">:</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">thmin</span> <span class="ow">and</span> <span class="n">fcopy</span><span class="o">.</span><span class="n">theory_logspace</span><span class="p">:</span>
                    <span class="n">xextra_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">thmin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xmin</span><span class="p">),</span> <span class="n">fcopy</span><span class="o">.</span><span class="n">th_num_pts</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xextra_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">thmin</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">fcopy</span><span class="o">.</span><span class="n">th_num_pts</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">fcopy</span><span class="o">.</span><span class="n">nextramin</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xextra_min</span><span class="p">)</span>
                <span class="n">data_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">xextra_min</span><span class="p">),</span> <span class="n">ncol</span><span class="p">))</span>
                <span class="n">data_min</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xextra_min</span>
                <span class="n">fcopy</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">data_min</span><span class="p">,</span> <span class="n">fcopy</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">thmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fcopy</span><span class="o">.</span><span class="n">theory_xmax</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">fcopy</span><span class="o">.</span><span class="n">nextramax</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># number of extra rows added right</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">thmax</span> <span class="o">&gt;</span> <span class="n">xmax</span><span class="p">:</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">thmax</span> <span class="ow">and</span> <span class="n">fcopy</span><span class="o">.</span><span class="n">theory_logspace</span><span class="p">:</span>
                    <span class="n">xextra_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xmax</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">thmax</span><span class="p">),</span> <span class="n">fcopy</span><span class="o">.</span><span class="n">th_num_pts</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xextra_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">thmax</span><span class="p">,</span> <span class="n">fcopy</span><span class="o">.</span><span class="n">th_num_pts</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">fcopy</span><span class="o">.</span><span class="n">nextramax</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xextra_max</span><span class="p">)</span>
                <span class="n">data_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">xextra_max</span><span class="p">),</span> <span class="n">ncol</span><span class="p">))</span>
                <span class="n">data_max</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xextra_max</span>
                <span class="n">fcopy</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">fcopy</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">data_max</span><span class="p">))</span>
        <span class="n">fcopy</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">=</span> <span class="n">fcopy</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="Theory.get_non_extended_th_table"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.get_non_extended_th_table">[docs]</a>    <span class="k">def</span> <span class="nf">get_non_extended_th_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return a copy of the theory table associated with f, where the extra rows are deleted&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">with_extra_x</span><span class="p">:</span>
            <span class="n">tmp_dt</span> <span class="o">=</span> <span class="n">DataTable</span><span class="p">(</span><span class="n">axarr</span><span class="o">=</span><span class="p">[])</span>
            <span class="n">nrow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">file_name_short</span><span class="p">]</span><span class="o">.</span><span class="n">num_rows</span>
            <span class="n">tmp_dt</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">file_name_short</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">nextramin</span><span class="p">:</span><span class="n">nrow</span><span class="o">-</span><span class="n">f</span><span class="o">.</span><span class="n">nextramax</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">tmp_dt</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">=</span> <span class="n">tmp_dt</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tmp_dt</span><span class="o">.</span><span class="n">num_columns</span> <span class="o">=</span> <span class="n">tmp_dt</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">tmp_dt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">file_name_short</span><span class="p">]</span></div>

<div class="viewcode-block" id="Theory.theory_files"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.theory_files">[docs]</a>    <span class="k">def</span> <span class="nf">theory_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_file</span><span class="p">:</span>
            <span class="n">selected_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">selected_file</span>
            <span class="k">if</span> <span class="n">selected_file</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">selected_file</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
                    <span class="n">f_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">selected_file</span>
                                <span class="p">)</span>  <span class="c1">#use the selected/highlighted file if active</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">f_list</span><span class="p">:</span>  <span class="c1">#there is no selected file or it is inactive or single_file=False</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
                    <span class="n">f_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_file</span><span class="p">:</span>
                        <span class="k">break</span>
        <span class="k">return</span> <span class="n">f_list</span></div>

<div class="viewcode-block" id="Theory.do_error"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.do_error">[docs]</a>    <span class="k">def</span> <span class="nf">do_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Report the error of the current theory</span>
<span class="sd">        </span>
<span class="sd">        Report the error of the current theory on all the files, taking into account</span>
<span class="sd">        the current selected xrange and yrange.</span>

<span class="sd">        File error is calculated as the mean square of the residual, averaged over all points in the file.</span>
<span class="sd">        Total error is the mean square of the residual, averaged over all points in all files.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - line {[type]} -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">total_error</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">npoints</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">parent_application</span><span class="o">.</span><span class="n">current_view</span>
        <span class="n">tools</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">parent_application</span><span class="o">.</span><span class="n">tools</span>       
        <span class="c1"># table=&#39;&#39;&#39;&lt;table border=&quot;1&quot; width=&quot;100%&quot;&gt;&#39;&#39;&#39;</span>
        <span class="c1"># table+=&#39;&#39;&#39;&lt;tr&gt;&lt;th&gt;File&lt;/th&gt;&lt;th&gt;Error (RSS)&lt;/th&gt;&lt;th&gt;# Pts&lt;/th&gt;&lt;/tr&gt;&#39;&#39;&#39;</span>
        <span class="n">tab_data</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;</span><span class="si">%-18s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;File&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%-18s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;Error (RSS)&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%-18s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;# Pts&#39;</span><span class="p">],]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theory_files</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_theory_flag</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">xexp</span><span class="p">,</span> <span class="n">yexp</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">view_proc</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">data_table</span><span class="p">,</span>
                                                 <span class="n">f</span><span class="o">.</span><span class="n">file_parameters</span><span class="p">)</span>
            <span class="n">tmp_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_non_extended_th_table</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">xth</span><span class="p">,</span> <span class="n">yth</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">view_proc</span><span class="p">(</span><span class="n">tmp_dt</span><span class="p">,</span>
                                               <span class="n">f</span><span class="o">.</span><span class="n">file_parameters</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()):</span>
                <span class="n">conditionx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xexp</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">xexp</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">conditionx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">xexp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()):</span>
                <span class="n">conditiony</span> <span class="o">=</span> <span class="p">(</span><span class="n">yexp</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">yexp</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">conditiony</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">yexp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
            <span class="n">conditionnaninf</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xexp</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yexp</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span>
                <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xth</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yth</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">xexp</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">yexp</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">xth</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">yth</span><span class="p">))</span>
            <span class="n">yexp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">conditionx</span> <span class="o">*</span> <span class="n">conditiony</span> <span class="o">*</span> <span class="n">conditionnaninf</span><span class="p">,</span> <span class="n">yexp</span><span class="p">)</span>
            <span class="n">yth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">conditionx</span> <span class="o">*</span> <span class="n">conditiony</span> <span class="o">*</span> <span class="n">conditionnaninf</span><span class="p">,</span> <span class="n">yth</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizebydata</span><span class="p">:</span>
                <span class="n">f_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(((</span><span class="n">yth</span> <span class="o">-</span> <span class="n">yexp</span><span class="p">)</span><span class="o">/</span><span class="n">yexp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">yth</span> <span class="o">-</span> <span class="n">yexp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">npt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yth</span><span class="p">)</span>
            <span class="n">total_error</span> <span class="o">+=</span> <span class="n">f_error</span> <span class="o">*</span> <span class="n">npt</span>
            <span class="n">npoints</span> <span class="o">+=</span> <span class="n">npt</span>
            <span class="c1"># table+= &#39;&#39;&#39;&lt;tr&gt;&lt;td&gt;%-18s&lt;/td&gt;&lt;td&gt;%-18.4g&lt;/td&gt;&lt;td&gt;%-18d&lt;/td&gt;&lt;/tr&gt;&#39;&#39;&#39;% (f.file_name_short, f_error, npt)</span>
            <span class="n">tab_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%-18s</span><span class="s1">&#39;</span><span class="o">%</span> <span class="n">f</span><span class="o">.</span><span class="n">file_name_short</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%-18.4g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">f_error</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%-18d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">npt</span><span class="p">])</span>
        <span class="c1"># table+=&#39;&#39;&#39;&lt;/table&gt;&lt;br&gt;&#39;&#39;&#39;</span>
        <span class="c1"># self.Qprint(table)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="n">tab_data</span><span class="p">)</span>

        <span class="c1">#count number of fitting parameters</span>
        <span class="n">free_p</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">opt_type</span> <span class="o">==</span> <span class="n">OptType</span><span class="o">.</span><span class="n">opt</span><span class="p">:</span>
                <span class="n">free_p</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">npoints</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">total_error</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;TOTAL ERROR&lt;/b&gt;: </span><span class="si">%12.5g</span><span class="s2"> (</span><span class="si">%d</span><span class="s2"> Pts)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">total_error</span> <span class="o">/</span> <span class="n">npoints</span><span class="p">,</span> <span class="n">npoints</span><span class="p">))</span>
            <span class="c1"># Bayesian information criterion (BIC) penalise free parametters (overfitting)</span>
            <span class="c1"># Model with lowest BIC number is prefered</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;Bayesian IC&lt;/b&gt;: </span><span class="si">%12.5g</span><span class="s2">&lt;br&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">npoints</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">total_error</span> <span class="o">/</span> <span class="n">npoints</span><span class="p">)</span> <span class="o">+</span> <span class="n">free_p</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">npoints</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;TOTAL ERROR&lt;/b&gt;: </span><span class="si">%12s</span><span class="s2"> (</span><span class="si">%6d</span><span class="s2">)&lt;br&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;N/A&quot;</span><span class="p">,</span> <span class="n">npoints</span><span class="p">))</span></div>

<div class="viewcode-block" id="Theory.fit_callback_basinhopping"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.fit_callback_basinhopping">[docs]</a>    <span class="k">def</span> <span class="nf">fit_callback_basinhopping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">accepted</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">accepted</span> <span class="ow">and</span> <span class="n">f</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">fminnow</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fminnow</span><span class="o">=</span><span class="n">f</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;nfeval </span><span class="si">%6d</span><span class="s2"> f=</span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfev</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_theory_flag</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Theory.fit_callback_dualannealing"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.fit_callback_dualannealing">[docs]</a>    <span class="k">def</span> <span class="nf">fit_callback_dualannealing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">fminnow</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fminnow</span><span class="o">=</span><span class="n">f</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;nfeval </span><span class="si">%6d</span><span class="s2"> f=</span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfev</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_theory_flag</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Theory.fit_callback_diffevol"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.fit_callback_diffevol">[docs]</a>    <span class="k">def</span> <span class="nf">fit_callback_diffevol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xk</span><span class="p">,</span> <span class="n">convergence</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;nfeval </span><span class="si">%6d</span><span class="s2"> frac=</span><span class="si">%g</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfev</span><span class="p">,</span> <span class="n">convergence</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_theory_flag</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Theory.fit_callback_shgo"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.fit_callback_shgo">[docs]</a>    <span class="k">def</span> <span class="nf">fit_callback_shgo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xk</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfev</span><span class="o">%</span><span class="mi">10</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;nfeval </span><span class="si">%6d</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">nfev</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_theory_flag</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Theory.fit_check_bounds"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.fit_check_bounds">[docs]</a>    <span class="k">def</span> <span class="nf">fit_check_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;x_new&quot;</span><span class="p">]</span>
        <span class="n">tmax</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="p">))</span>
        <span class="n">tmin</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tmax</span> <span class="ow">and</span> <span class="n">tmin</span></div>

<div class="viewcode-block" id="Theory.func_fit_and_error"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.func_fit_and_error">[docs]</a>    <span class="k">def</span> <span class="nf">func_fit_and_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calls the theory function, constructs the vector with the theory predictions and </span>
<span class="sd">           returns the sum of the squares of the residuals</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># NEED TO RECOVER THE VECTOR y THAT WE CONSTRUCTED DURING FUNCTION FIT</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizebydata</span><span class="p">:</span>
            <span class="n">residuals</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fittingy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">func_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fittingx</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">fittingy</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">residuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fittingy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">func_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fittingx</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="n">fres</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">residuals</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fres</span></div>

<div class="viewcode-block" id="Theory.func_fit"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.func_fit">[docs]</a>    <span class="k">def</span> <span class="nf">func_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">param_in</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calls the theory function and constructs the vector with the theory predictions</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - x {[type]} -- [description]</span>
<span class="sd">            - \*param_in {[type]} -- [description]</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            - [type] -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. Assign the current values of the parameters being optimized</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">k</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
            <span class="n">par</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">opt_type</span> <span class="o">==</span> <span class="n">OptType</span><span class="o">.</span><span class="n">opt</span><span class="p">:</span>
                <span class="n">par</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">param_in</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># 2. Call the theory function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_calculate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># 3. Constructs the y vector that contains all the Y values from the theory after </span>
        <span class="c1">#    applying the current view and respecting the {xmin, xmax} &amp; {ymin, ymax} limits</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">parent_application</span><span class="o">.</span><span class="n">current_view</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theory_files</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
                <span class="n">tmp_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_non_extended_th_table</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">xth</span><span class="p">,</span> <span class="n">yth</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">view_proc</span><span class="p">(</span>
                    <span class="n">tmp_dt</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">file_parameters</span><span class="p">)</span>
                <span class="n">xexp</span><span class="p">,</span> <span class="n">yexp</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">view_proc</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">data_table</span><span class="p">,</span>
                                                     <span class="n">f</span><span class="o">.</span><span class="n">file_parameters</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()):</span>
                        <span class="n">conditionx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xexp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">xexp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">conditionx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">xexp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()):</span>
                        <span class="n">conditiony</span> <span class="o">=</span> <span class="p">(</span><span class="n">yexp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">yexp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">conditiony</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">yexp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
                    <span class="n">conditionnaninf</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xexp</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yexp</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">xexp</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">yexp</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="n">ycond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span>
                        <span class="n">conditionx</span> <span class="o">*</span> <span class="n">conditiony</span> <span class="o">*</span> <span class="n">conditionnaninf</span><span class="p">,</span> <span class="n">yth</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ycond</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfev</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">y</span></div>

<div class="viewcode-block" id="Theory.do_fit"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.do_fit">[docs]</a>    <span class="k">def</span> <span class="nf">do_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Minimize the error</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - line {[type]} -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Do some initial checks on the status of datasets and theories</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_fitting</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">inactive_files</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">files</span><span class="p">):</span>  <span class="c1">#all files hidden</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_fitting</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span>
        <span class="n">th_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theory_files</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">th_files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_fitting</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span>

        <span class="c1"># Start the fitting procedure</span>
        <span class="c1"># 1. Create x and y vectors that contain the X and Y values of all the active files</span>
        <span class="c1">#    in the current view that respect the {xmin, xmax} &amp; {ymin, ymax} limits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_fitting</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">parent_application</span><span class="o">.</span><span class="n">current_view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;&lt;hr&gt;&lt;h2&gt;Parameter Fitting&lt;/h2&gt;&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="c1"># Vectors that contain all X and Y in the files &amp; view</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="o">.</span><span class="n">get_visible</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;xrange&lt;/b&gt;=[</span><span class="si">%0.3g</span><span class="s2">, </span><span class="si">%0.3g</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="o">.</span><span class="n">get_visible</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;yrange&lt;/b&gt;=[</span><span class="si">%.03g</span><span class="s2">, </span><span class="si">%0.3g</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">th_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_theory_flag</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
                <span class="n">xexp</span><span class="p">,</span> <span class="n">yexp</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">view_proc</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">data_table</span><span class="p">,</span>
                                                     <span class="n">f</span><span class="o">.</span><span class="n">file_parameters</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()):</span>
                        <span class="n">conditionx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xexp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">xexp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">conditionx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">xexp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()):</span>
                        <span class="n">conditiony</span> <span class="o">=</span> <span class="p">(</span><span class="n">yexp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">yexp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">conditiony</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">yexp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
                    <span class="n">conditionnaninf</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xexp</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">yexp</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">xexp</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">yexp</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="n">xcond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span>
                        <span class="n">conditionx</span> <span class="o">*</span> <span class="n">conditiony</span> <span class="o">*</span> <span class="n">conditionnaninf</span><span class="p">,</span> <span class="n">xexp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
                    <span class="n">ycond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span>
                        <span class="n">conditionx</span> <span class="o">*</span> <span class="n">conditiony</span> <span class="o">*</span> <span class="n">conditionnaninf</span><span class="p">,</span> <span class="n">yexp</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>

                    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xcond</span><span class="p">)</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ycond</span><span class="p">)</span>

        <span class="c1"># 2. Create the array of theory parameters that will be chenged during the fitting (checked parameters)</span>
        <span class="c1">#    It also creates the arrays with the upper and lower bounds for parameters</span>
        <span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Take the initial guess for the fit from the current value of the parameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_min</span> <span class="o">=</span> <span class="p">[]</span>     <span class="c1"># list of min values for fitting parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_max</span> <span class="o">=</span> <span class="p">[]</span>     <span class="c1"># list of max values for fitting parameters</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">k</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
            <span class="n">par</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">opt_type</span> <span class="o">==</span> <span class="n">OptType</span><span class="o">.</span><span class="n">opt</span><span class="p">:</span>
                <span class="n">initial_guess</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">min_value</span><span class="p">)</span>  
                <span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">max_value</span><span class="p">)</span>  
        <span class="c1"># Return if the list of checked parameters is empty</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">initial_guess</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;No parameter to minimize&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_fitting</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span>
        
        <span class="c1"># 3. This is where the actual optimization is done</span>
        <span class="c1"># TODO: We should add the option to use different minimization methods</span>
        <span class="c1">#       like those included in scipy or even other ones implemented by us (MC methods)</span>
        <span class="c1">#opt = dict(return_full=True) # I think this is not used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfev</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fittingx</span> <span class="o">=</span> <span class="n">x</span> <span class="c1"># MAKE EXPERIMENTAL x VECTOR AVAILABLE GLOBAL OPTIMISATION</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fittingy</span> <span class="o">=</span> <span class="n">y</span> <span class="c1"># MAKE EXPERIMENTAL y VECTOR AVAILABLE GLOBAL OPTIMISATION</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fminnow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mintype</span><span class="o">==</span><span class="n">MinimizationMethod</span><span class="o">.</span><span class="n">dualannealing</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mintype</span><span class="o">==</span><span class="n">MinimizationMethod</span><span class="o">.</span><span class="n">diffevol</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mintype</span><span class="o">==</span><span class="n">MinimizationMethod</span><span class="o">.</span><span class="n">SHGO</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="p">))</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="p">))</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="p">))</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="p">))):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;This fitting method cannot be used if any of the bounds is ¬± nan or ¬± inf&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_fitting</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mintype</span><span class="o">==</span><span class="n">MinimizationMethod</span><span class="o">.</span><span class="n">ls</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;Non-linear Least-squares&lt;/b&gt;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;Local optimisation&lt;/b&gt;&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">LSmethod</span><span class="o">==</span><span class="s1">&#39;trf&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;Method: Trust Region Reflective&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">LSmethod</span><span class="o">==</span><span class="s1">&#39;dogbox&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;Method: dogleg&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">LSmethod</span><span class="o">==</span><span class="s1">&#39;lm&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;Method: Levenberg-Marquardt&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">LSmethod</span><span class="o">==</span><span class="s1">&#39;trf&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">LSmethod</span><span class="o">==</span><span class="s1">&#39;dogbox&#39;</span><span class="p">:</span>
                    <span class="n">pars</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func_fit</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">initial_guess</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="p">),</span> 
                                        <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSmethod</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSjac</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSftol</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSxtol</span><span class="p">,</span>
                                        <span class="n">gtol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSgtol</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSloss</span><span class="p">,</span> <span class="n">f_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSf_scale</span><span class="p">,</span> <span class="n">max_nfev</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSmax_fnev</span><span class="p">,</span>
                                        <span class="n">tr_solver</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LStr_solver</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">LSmax_fnev</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                        <span class="n">pars</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func_fit</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">initial_guess</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="p">),</span> 
                                            <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSmethod</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSftol</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSxtol</span><span class="p">,</span>
                                            <span class="n">gtol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSgtol</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pars</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func_fit</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">initial_guess</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="p">),</span> 
                                            <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSmethod</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSftol</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSxtol</span><span class="p">,</span>
                                            <span class="n">gtol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSgtol</span><span class="p">,</span> <span class="n">maxfev</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LSmax_fnev</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;In do_fit()&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_fitting</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">return</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mintype</span><span class="o">==</span><span class="n">MinimizationMethod</span><span class="o">.</span><span class="n">basinhopping</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;Basin Hopping&lt;b&gt;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;Global optimisation&lt;/b&gt;&#39;</span><span class="p">)</span>
            <span class="n">minimizer_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;BFGS&quot;</span><span class="p">}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">basinhopping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func_fit_and_error</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basinniter</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basinT</span><span class="p">,</span> 
                                   <span class="n">stepsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basinstepsize</span><span class="p">,</span> <span class="n">minimizer_kwargs</span><span class="o">=</span><span class="n">minimizer_kwargs</span><span class="p">,</span>  
                                   <span class="n">accept_test</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_check_bounds</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_callback_basinhopping</span><span class="p">,</span> 
                                   <span class="n">interval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basininterval</span><span class="p">,</span> <span class="n">niter_success</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basinniter_success</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basinseed</span><span class="p">)</span>
                <span class="n">initial_guess1</span><span class="o">=</span><span class="n">ret</span><span class="o">.</span><span class="n">x</span>
                <span class="n">pars</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func_fit</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">initial_guess1</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;trf&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;In do_fit()&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_fitting</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">return</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mintype</span><span class="o">==</span><span class="n">MinimizationMethod</span><span class="o">.</span><span class="n">dualannealing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;Dual Annealing&lt;b&gt;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;Global optimisation&lt;/b&gt;&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">param_bounds</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="p">))</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">dual_annealing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func_fit_and_error</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">param_bounds</span><span class="p">,</span> 
                                     <span class="n">maxiter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">annealmaxiter</span><span class="p">,</span> <span class="n">initial_temp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">annealinitial_temp</span><span class="p">,</span> 
                                     <span class="n">restart_temp_ratio</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">annealrestart_temp_ratio</span><span class="p">,</span> 
                                     <span class="n">visit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">annealvisit</span><span class="p">,</span> <span class="n">accept</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">annealaccept</span><span class="p">,</span> 
                                     <span class="n">maxfun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">annealmaxfun</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">annealseed</span><span class="p">,</span>
                                     <span class="n">no_local_search</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">annealno_local_search</span><span class="p">,</span>
                                     <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_callback_dualannealing</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">initial_guess</span><span class="p">)</span>
                <span class="n">initial_guess1</span><span class="o">=</span><span class="n">ret</span><span class="o">.</span><span class="n">x</span>
                <span class="n">pars</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func_fit</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">initial_guess1</span><span class="p">,</span> 
                                       <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;trf&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;In do_fit()&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_fitting</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">return</span> 

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mintype</span><span class="o">==</span><span class="n">MinimizationMethod</span><span class="o">.</span><span class="n">diffevol</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;Differential Evolution&lt;b&gt;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;Global optimisation&lt;/b&gt;&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">param_bounds</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="p">))</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">differential_evolution</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func_fit_and_error</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">param_bounds</span><span class="p">,</span> 
                                             <span class="n">strategy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffevolstrategy</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffevolmaxiter</span><span class="p">,</span>
                                             <span class="n">popsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffevolpopsize</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffevoltol</span><span class="p">,</span> 
                                             <span class="n">mutation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffevolmutation</span><span class="p">,</span> <span class="n">recombination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffevolrecombination</span><span class="p">,</span>
                                             <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffevolseed</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_callback_diffevol</span><span class="p">,</span>
                                             <span class="n">polish</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffevolpolish</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffevolinit</span><span class="p">,</span> 
                                             <span class="n">atol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffevolatol</span><span class="p">,</span> <span class="n">updating</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">diffevolupdating</span><span class="p">)</span>
                <span class="n">initial_guess1</span><span class="o">=</span><span class="n">ret</span><span class="o">.</span><span class="n">x</span>
                <span class="n">pars</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func_fit</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">initial_guess1</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="p">),</span> 
                                       <span class="n">method</span><span class="o">=</span><span class="s1">&#39;trf&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;In do_fit()&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_fitting</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">return</span> 
                
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mintype</span><span class="o">==</span><span class="n">MinimizationMethod</span><span class="o">.</span><span class="n">SHGO</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;Simplicial Homology Global Optimization&lt;b&gt;&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">param_bounds</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="p">))</span>
                <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;maxfev&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHGOmaxfev</span><span class="p">,</span> <span class="s1">&#39;f_min&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHGOf_min</span><span class="p">,</span> <span class="s1">&#39;f_tol&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHGOf_tol</span><span class="p">,</span>
                         <span class="s1">&#39;maxiter&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHGOmaxiter</span><span class="p">,</span> <span class="s1">&#39;maxev&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHGOmaxev</span><span class="p">,</span> <span class="s1">&#39;maxtime&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHGOmaxtime</span><span class="p">,</span>
                         <span class="s1">&#39;minhgrd&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHGOminhgrd</span><span class="p">,</span> <span class="s1">&#39;minimize_every_iter&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHGOminimize_every_iter</span><span class="p">,</span> 
                         <span class="s1">&#39;local_iter&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHGOlocal_iter</span><span class="p">,</span> <span class="s1">&#39;infty_constraints&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHGOinfty_constraints</span><span class="p">}</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">shgo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func_fit_and_error</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">param_bounds</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SHGOn</span><span class="p">,</span> <span class="n">iters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SHGOiters</span><span class="p">,</span>
                           <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_callback_shgo</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">sampling_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SHGOsampling_method</span><span class="p">)</span>
                <span class="n">initial_guess1</span><span class="o">=</span><span class="n">ret</span><span class="o">.</span><span class="n">x</span>
                <span class="n">pars</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func_fit</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">initial_guess1</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="p">),</span> 
                                       <span class="n">method</span><span class="o">=</span><span class="s1">&#39;trf&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;In do_fit()&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_fitting</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">return</span> 

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mintype</span><span class="o">==</span><span class="n">MinimizationMethod</span><span class="o">.</span><span class="n">bruteforce</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;Brute Force Global Optimization&lt;b&gt;&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">param_bounds</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="p">))</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">brute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func_fit_and_error</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="n">param_bounds</span><span class="p">,</span> <span class="n">Ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">BruteNs</span><span class="p">)</span>
                <span class="n">initial_guess1</span><span class="o">=</span><span class="n">ret</span>
                <span class="n">pars</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func_fit</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">initial_guess1</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_max</span><span class="p">),</span> 
                                       <span class="n">method</span><span class="o">=</span><span class="s1">&#39;trf&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;In do_fit()&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_fitting</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">return</span> 

        <span class="c1"># 4. Statistical analysis of the solution found</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">func_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">initial_guess</span><span class="p">)</span>
        <span class="n">fres0</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">residuals</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">func_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">pars</span><span class="p">)</span>
        <span class="n">fres1</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">residuals</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># table=&#39;&#39;&#39;&lt;table border=&quot;1&quot; width=&quot;100%&quot;&gt;&#39;&#39;&#39;</span>
        <span class="c1"># table+=&#39;&#39;&#39;&lt;tr&gt;&lt;th&gt;Initial Error&lt;/th&gt;&lt;th&gt;Final Error&lt;/th&gt;&lt;/tr&gt;&#39;&#39;&#39;</span>
        <span class="c1"># table+=&#39;&#39;&#39;&lt;tr&gt;&lt;td&gt;%g&lt;/td&gt;&lt;td&gt;%g&lt;/td&gt;&lt;/tr&gt;&#39;&#39;&#39;%(fres0, fres1)</span>
        <span class="c1"># table+=&#39;&#39;&#39;&lt;/table&gt;&lt;br&gt;&#39;&#39;&#39;</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;</span><span class="si">%-18s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;Initial Error&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%-18s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;Final Error&#39;</span><span class="p">],]</span>
        <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%-18g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fres0</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%-18g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fres1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;</span><span class="si">%g</span><span class="s1">&lt;/b&gt; function evaluations&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfev</span><span class="p">))</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c1"># 95% confidence interval = 100*(1-alpha)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># number of data points</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span>  <span class="c1"># number of parameters</span>
        <span class="n">dof</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>  <span class="c1"># number of degrees of freedom</span>
        <span class="c1"># student-t value for the dof and confidence level</span>
        <span class="n">tval</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">dof</span><span class="p">)</span>

        <span class="n">par_error</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#for i, p, var in zip(range(p), pars, np.diag(pcov)):</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov</span><span class="p">):</span>
            <span class="n">sigma</span> <span class="o">=</span> <span class="n">var</span><span class="o">**</span><span class="mf">0.5</span>
            <span class="n">par_error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">tval</span><span class="p">)</span>

        <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># table=&#39;&#39;&#39;&lt;table border=&quot;1&quot; width=&quot;100%&quot;&gt;&#39;&#39;&#39;</span>
        <span class="c1"># table+=&#39;&#39;&#39;&lt;tr&gt;&lt;th&gt;Parameter&lt;/th&gt;&lt;th&gt;Value ¬± Error&lt;/th&gt;&lt;/tr&gt;&#39;&#39;&#39;</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;</span><span class="si">%-18s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;Parameter&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%-18s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;Value ¬± Error&#39;</span><span class="p">],</span> <span class="p">]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
            <span class="n">par</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">opt_type</span> <span class="o">==</span> <span class="n">OptType</span><span class="o">.</span><span class="n">opt</span><span class="p">:</span>
                <span class="n">par</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">par_error</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># table+=&#39;&#39;&#39;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%10.4g ¬± %-9.4g&lt;/td&gt;&lt;/tr&gt;&#39;&#39;&#39;%(par.name, par.value, par.error)</span>
                <span class="n">val_err</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.4g</span><span class="s1"> ¬± </span><span class="si">%.4g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
                <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%-18s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%-18s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">val_err</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># table+=&#39;&#39;&#39;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%10.4g&lt;/td&gt;&lt;/tr&gt;&#39;&#39;&#39;%(par.name, par.value)</span>
                <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%-18s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%-18.4g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">par</span><span class="o">.</span><span class="n">value</span><span class="p">])</span>
        <span class="c1"># table+=&#39;&#39;&#39;&lt;/table&gt;&lt;br&gt;&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">is_fitting</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_calculate</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;&lt;i&gt;---Fitted in </span><span class="si">%.3g</span><span class="s1"> seconds---&lt;/i&gt;&lt;br&gt;&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_cite</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theory.do_print"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.do_print">[docs]</a>    <span class="k">def</span> <span class="nf">do_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print the theory table associated with the given file name</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - line {[type]} -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">line</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Theory table for </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> not found&quot;</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theory.complete_print"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.complete_print">[docs]</a>    <span class="k">def</span> <span class="nf">complete_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">begidx</span><span class="p">,</span> <span class="n">endidx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - text {[type]} -- [description]</span>
<span class="sd">            - line {[type]} -- [description]</span>
<span class="sd">            - begidx {[type]} -- [description]</span>
<span class="sd">            - endidx {[type]} -- [description]</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            [type] -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
            <span class="n">completions</span> <span class="o">=</span> <span class="n">file_names</span><span class="p">[:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">completions</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">file_names</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">text</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">completions</span></div>

<div class="viewcode-block" id="Theory.do_parameters"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.do_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">do_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;View and switch the minimization state of the theory parameters</span>
<span class="sd">           parameters A B</span>
<span class="sd">        </span>
<span class="sd">        Several parameters are allowed</span>
<span class="sd">        With no arguments, show the current values</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            line {[type]} -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="n">plist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">plist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%9s</span><span class="s2">   </span><span class="si">%10s</span><span class="s2"> (with * = is optimized)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;Parameter&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;Value&quot;</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==================================&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">opt_type</span> <span class="o">==</span> <span class="n">OptType</span><span class="o">.</span><span class="n">opt</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*</span><span class="si">%8s</span><span class="s2"> = </span><span class="si">%10.5g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">opt_type</span> <span class="o">==</span> <span class="n">OptType</span><span class="o">.</span><span class="n">nopt</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%8s</span><span class="s2"> = </span><span class="si">%10.5g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">opt_type</span> <span class="o">==</span> <span class="n">OptType</span><span class="o">.</span><span class="n">const</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%8s</span><span class="s2"> = </span><span class="si">%10.5g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">opt_type</span> <span class="o">==</span> <span class="n">OptType</span><span class="o">.</span><span class="n">opt</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">opt_type</span> <span class="o">==</span> <span class="n">OptType</span><span class="o">.</span><span class="n">nopt</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">opt_type</span> <span class="o">==</span> <span class="n">OptType</span><span class="o">.</span><span class="n">nopt</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">opt_type</span> <span class="o">==</span> <span class="n">OptType</span><span class="o">.</span><span class="n">opt</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">opt_type</span> <span class="o">==</span> <span class="n">OptType</span><span class="o">.</span><span class="n">const</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parameter </span><span class="si">%s</span><span class="s2"> is not optimized&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parameter </span><span class="si">%s</span><span class="s2"> not found&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theory.complete_parameters"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.complete_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">complete_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">begidx</span><span class="p">,</span> <span class="n">endidx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - text {[type]} -- [description]</span>
<span class="sd">            - line {[type]} -- [description]</span>
<span class="sd">            - begidx {[type]} -- [description]</span>
<span class="sd">            - endidx {[type]} -- [description]</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            - [type] -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parameter_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
            <span class="n">completions</span> <span class="o">=</span> <span class="n">parameter_names</span><span class="p">[:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">completions</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">parameter_names</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">text</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">completions</span>        </div>
        
<div class="viewcode-block" id="Theory.plot_theory_stuff"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.plot_theory_stuff">[docs]</a>    <span class="k">def</span> <span class="nf">plot_theory_stuff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<span class="c1"># SAVE THEORY STUFF</span>

<div class="viewcode-block" id="Theory.do_save"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.do_save">[docs]</a>    <span class="k">def</span> <span class="nf">do_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">extra_txt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the results from all theory predictions to file</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - line {[type]} -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s1">&#39;Saving prediction(s) of &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; theory&#39;</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
            <span class="n">fparam</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">file_parameters</span>
            <span class="n">ttable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">file_name_short</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">ofilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">file_full_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_TH&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">file_full_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ofilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">file_name_short</span> <span class="o">+</span> <span class="s1">&#39;_TH&#39;</span> <span class="o">+</span> <span class="n">extra_txt</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">file_full_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1"># print(&quot;ofilename&quot;, ofilename)</span>
            <span class="c1"># print(&#39;File: &#39; + f.file_name_short)</span>
            <span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">ofilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">file_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">k</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">file_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="p">)</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Prediction of &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">thname</span> <span class="o">+</span> <span class="s1">&#39; Theory</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# &#39;</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">k</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;; &#39;</span><span class="p">)</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Date: &#39;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span> <span class="o">+</span>
                       <span class="s1">&#39; - User: &#39;</span> <span class="o">+</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">file_type</span><span class="o">.</span><span class="n">col_names</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ttable</span><span class="o">.</span><span class="n">num_rows</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ttable</span><span class="o">.</span><span class="n">num_columns</span><span class="p">):</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ttable</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># print information</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Saved </span><span class="si">%d</span><span class="s1"> theory file(s) in &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">counter</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">CmdBase</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">CmdMode</span><span class="o">.</span><span class="n">GUI</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Saved Theory&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<span class="c1"># SPAN STUFF</span>

<div class="viewcode-block" id="Theory.change_xmin"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.change_xmin">[docs]</a>    <span class="k">def</span> <span class="nf">change_xmin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - dx {[type]} -- [description]</span>
<span class="sd">            - dy {[type]} -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span> <span class="o">+=</span> <span class="n">dx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xminline</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="o">.</span><span class="n">set_xy</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Theory.change_xmax"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.change_xmax">[docs]</a>    <span class="k">def</span> <span class="nf">change_xmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - dx {[type]} -- [description]</span>
<span class="sd">            - dy {[type]} -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span> <span class="o">+=</span> <span class="n">dx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xmaxline</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="o">.</span><span class="n">set_xy</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Theory.change_ymin"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.change_ymin">[docs]</a>    <span class="k">def</span> <span class="nf">change_ymin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - dx {[type]} -- [description]</span>
<span class="sd">            - dy {[type]} -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span> <span class="o">+=</span> <span class="n">dy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yminline</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="o">.</span><span class="n">set_xy</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">],</span>
                            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">]])</span></div>

<div class="viewcode-block" id="Theory.change_ymax"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.change_ymax">[docs]</a>    <span class="k">def</span> <span class="nf">change_ymax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - dx {[type]} -- [description]</span>
<span class="sd">            - dy {[type]} -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span> <span class="o">+=</span> <span class="n">dy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymaxline</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="o">.</span><span class="n">set_xy</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">],</span>
                            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">]])</span></div>

<div class="viewcode-block" id="Theory.do_xrange"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.do_xrange">[docs]</a>    <span class="k">def</span> <span class="nf">do_xrange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set/show xrange for fit and shows limits</span>
<span class="sd">        </span>
<span class="sd">        With no arguments: switches ON/OFF the horizontal span</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - line {[xmin xmax]} -- Sets the limits of the span</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">visible</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">visible</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;.. todo:: Set range to current view limits&quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xminline</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xmaxline</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="o">.</span><span class="n">set_xy</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xminline</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xmaxline</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Not enough parameters&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xminline</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xmaxline</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="o">.</span><span class="n">set_xy</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span>
                                                     <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xminline</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xmaxline</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_plot</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theory.do_yrange"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.do_yrange">[docs]</a>    <span class="k">def</span> <span class="nf">do_yrange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set/show yrange for fit and shows limits</span>
<span class="sd">        </span>
<span class="sd">        With no arguments: switches ON/OFF the vertical span</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - line {[ymin ymax]} -- Sets the limits of the span</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">visible</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">visible</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yminline</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ymaxline</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="o">.</span><span class="n">set_xy</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yminline</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ymaxline</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>
            <span class="c1"># print(&quot;Ymin=%g Ymax=%g&quot; % (self.ymin, self.ymax))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Not enough parameters&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yminline</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ymaxline</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="o">.</span><span class="n">set_xy</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">],</span>
                                    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">],</span>
                                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">]])</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">yminline</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ymaxline</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_plot</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theory.set_xy_limits_visible"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.set_xy_limits_visible">[docs]</a>    <span class="k">def</span> <span class="nf">set_xy_limits_visible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xstate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ystate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Hide the x- and y-range selectors</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">xstate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xminline</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">xstate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmaxline</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">xstate</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">ystate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yminline</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">ystate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymaxline</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">ystate</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">actionVertical_Limits</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">xstate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">actionHorizontal_Limits</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">ystate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">set_limit_icon</span><span class="p">()</span></div>


<span class="c1"># MODES STUFF</span>

<div class="viewcode-block" id="Theory.copy_modes"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.copy_modes">[docs]</a>    <span class="k">def</span> <span class="nf">copy_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">apmng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">parent_application</span><span class="o">.</span><span class="n">parent_manager</span>
        <span class="n">L</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span> <span class="n">apmng</span><span class="o">.</span><span class="n">list_theories_Maxwell</span><span class="p">(</span><span class="n">th_exclude</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found </span><span class="si">%d</span><span class="s2"> theories that provide modes&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">))</span>
        <span class="n">kys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">kys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kys</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select theory (number between 0 and </span><span class="si">%d</span><span class="s2">&gt; &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">opt</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">opt</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid option!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tau</span><span class="p">,</span> <span class="n">G0</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">kys</span><span class="p">[</span><span class="n">opt</span><span class="p">]]()</span>
            <span class="n">tauinds</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">tau</span><span class="p">)</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">tauinds</span><span class="p">]</span>
            <span class="n">G0</span> <span class="o">=</span> <span class="n">G0</span><span class="p">[</span><span class="n">tauinds</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_modes</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">G0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theory.do_copy_modes"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.do_copy_modes">[docs]</a>    <span class="k">def</span> <span class="nf">do_copy_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - line {[type]} -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy_modes</span><span class="p">()</span></div>

<div class="viewcode-block" id="Theory.get_modes"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.get_modes">[docs]</a>    <span class="k">def</span> <span class="nf">get_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            - [type] -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tau</span><span class="p">,</span> <span class="n">G</span></div>

<div class="viewcode-block" id="Theory.set_modes"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.set_modes">[docs]</a>    <span class="k">def</span> <span class="nf">set_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">G</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - tau {[type]} -- [description]</span>
<span class="sd">            - G {[type]} -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Theory.do_cite"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.do_cite">[docs]</a>    <span class="k">def</span> <span class="nf">do_cite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print citation information</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - line {[type]} -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">citations</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qprint</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;&lt;b&gt;&lt;font color=red&gt;CITE&lt;/font&gt;:&lt;/b&gt; &lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;&lt;p&gt;&#39;&#39;&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">citations</span><span class="p">))</span></div>

<div class="viewcode-block" id="Theory.do_plot"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.do_plot">[docs]</a>    <span class="k">def</span> <span class="nf">do_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call the plot from the parent Dataset</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - line {[type]} -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">do_plot</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>
        <span class="c1">#self.plot_theory_stuff()</span>

<div class="viewcode-block" id="Theory.set_param_value"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.set_param_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_param_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - name {[type]} -- [description]</span>
<span class="sd">            - value {[type]} -- [description]</span>

<span class="sd">        Returns:</span>
<span class="sd">            - Success{bool} -- True if the operation was successful</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">ParameterType</span><span class="o">.</span><span class="n">real</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;Value must be a float&quot;</span><span class="p">,</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">p</span><span class="o">.</span><span class="n">min_value</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">min_value</span>
                    <span class="k">return</span> <span class="s1">&#39;Value must be greater than </span><span class="si">%.4g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">min_value</span><span class="p">,</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">max_value</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">max_value</span>
                    <span class="k">return</span> <span class="s1">&#39;Value must be smaller than </span><span class="si">%.4g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">max_value</span><span class="p">,</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">ParameterType</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c1">#convert to int</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;Value must be an integer&quot;</span><span class="p">,</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">p</span><span class="o">.</span><span class="n">min_value</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">min_value</span>
                    <span class="k">return</span> <span class="s1">&#39;Value must be greater than </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">min_value</span><span class="p">,</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">max_value</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">max_value</span>
                    <span class="k">return</span> <span class="s1">&#39;Value must be smaller than </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">max_value</span><span class="p">,</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">ParameterType</span><span class="o">.</span><span class="n">discrete_integer</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c1">#convert to int</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;Value must be an integer&quot;</span><span class="p">,</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">discrete_values</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Values allowed: &quot;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">discrete_values</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">message</span><span class="p">,</span> <span class="kc">False</span>

            <span class="k">elif</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">ParameterType</span><span class="o">.</span><span class="n">discrete_real</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;Value must be a float&quot;</span><span class="p">,</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">discrete_values</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Values allowed: &quot;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">discrete_values</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">message</span><span class="p">,</span> <span class="kc">False</span>

            <span class="k">elif</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">ParameterType</span><span class="o">.</span><span class="n">boolean</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">]:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">ParameterType</span><span class="o">.</span><span class="n">string</span><span class="p">):</span>
                <span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span> <span class="p">,</span> <span class="kc">True</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;In set_param_value:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Theory.default"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.default">[docs]</a>    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called when the input command is not recognized</span>
<span class="sd">        </span>
<span class="sd">        Called on an input line when the command prefix is not recognized.</span>
<span class="sd">        Check if there is an = sign in the line. If so, it is a parameter change.</span>
<span class="sd">        Else, we execute the line as Python code.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - line {[type]} -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">par</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="n">par</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">par</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parameter </span><span class="si">%s</span><span class="s2"> not found&quot;</span> <span class="o">%</span> <span class="n">par</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">line</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">line</span><span class="p">]</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Theory</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theory.show_theory_extras"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.show_theory_extras">[docs]</a>    <span class="k">def</span> <span class="nf">show_theory_extras</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Theory.do_hide"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.do_hide">[docs]</a>    <span class="k">def</span> <span class="nf">do_hide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Hide the theory artists and associated tools</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_xy_limits_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1"># hide xrange and yrange</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">MAX_NUM_SERIES</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">nx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">nplots</span><span class="p">):</span>
                        <span class="n">table</span><span class="o">.</span><span class="n">series</span><span class="p">[</span><span class="n">nx</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_theory_extras</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Theory.set_th_table_visible"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.set_th_table_visible">[docs]</a>    <span class="k">def</span> <span class="nf">set_th_table_visible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show/Hide all theory lines related to the file &quot;fname&quot; &quot;&quot;&quot;</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">MAX_NUM_SERIES</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">nx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">nplots</span><span class="p">):</span>
                <span class="n">tt</span><span class="o">.</span><span class="n">series</span><span class="p">[</span><span class="n">nx</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theory.do_show"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.do_show">[docs]</a>    <span class="k">def</span> <span class="nf">do_show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_xy_limits_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_xrange_visible</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">is_yrange_visible</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">inactive_files</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">MAX_NUM_SERIES</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">nx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">nplots</span><span class="p">):</span>
                        <span class="n">tt</span><span class="o">.</span><span class="n">series</span><span class="p">[</span><span class="n">nx</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_theory_extras</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">do_plot</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Theory.Qprint"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.Qprint">[docs]</a>    <span class="k">def</span> <span class="nf">Qprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>
<span class="sd">        </span>
<span class="sd">        [description]</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            - msg {[type]} -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">CmdBase</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">CmdMode</span><span class="o">.</span><span class="n">GUI</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_as_html</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">end</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">end</span> <span class="o">==</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_as_ascii</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strip_tags</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Theory.table_as_html"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.table_as_html">[docs]</a>    <span class="k">def</span> <span class="nf">table_as_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tab</span><span class="p">):</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;&lt;table border=&quot;1&quot; width=&quot;100%&quot;&gt;&#39;&#39;&#39;</span>
        <span class="c1"># header</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">h</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">header</span><span class="p">]):</span>
            <span class="n">table</span> <span class="o">+=</span> <span class="s1">&#39;&lt;tr&gt;&#39;</span>
            <span class="n">table</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;&lt;th&gt;</span><span class="si">%s</span><span class="s1">&lt;/th&gt;&#39;</span> <span class="o">%</span> <span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">header</span><span class="p">])</span>
            <span class="n">table</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/tr&gt;&#39;</span>
        <span class="c1">#data</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">+=</span> <span class="s1">&#39;&lt;tr&gt;&#39;</span>
            <span class="n">table</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;&lt;td&gt;</span><span class="si">%s</span><span class="s1">&lt;/td&gt;&#39;</span> <span class="o">%</span> <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">row</span><span class="p">])</span>
            <span class="n">table</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/tr&gt;&#39;</span>
        <span class="n">table</span><span class="o">+=</span><span class="s1">&#39;&#39;&#39;&lt;/table&gt;&lt;br&gt;&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">table</span></div>

<div class="viewcode-block" id="Theory.table_as_ascii"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.table_as_ascii">[docs]</a>    <span class="k">def</span> <span class="nf">table_as_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tab</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tab</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">text</span></div>

<div class="viewcode-block" id="Theory.strip_tags"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.strip_tags">[docs]</a>    <span class="k">def</span> <span class="nf">strip_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html_text</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">MLStripper</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">html_text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span></div>

<div class="viewcode-block" id="Theory.print_qtextbox"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.print_qtextbox">[docs]</a>    <span class="k">def</span> <span class="nf">print_qtextbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print message in the GUI log text box&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thTextBox</span><span class="o">.</span><span class="n">moveCursor</span><span class="p">(</span><span class="n">QTextCursor</span><span class="o">.</span><span class="n">End</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thTextBox</span><span class="o">.</span><span class="n">insertHtml</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thTextBox</span><span class="o">.</span><span class="n">verticalScrollBar</span><span class="p">()</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thTextBox</span><span class="o">.</span><span class="n">verticalScrollBar</span><span class="p">()</span><span class="o">.</span><span class="n">maximum</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thTextBox</span><span class="o">.</span><span class="n">moveCursor</span><span class="p">(</span><span class="n">QTextCursor</span><span class="o">.</span><span class="n">End</span><span class="p">)</span></div>


<div class="viewcode-block" id="Theory.get_material_parameters"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.get_material_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">get_material_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get theory parameters from materials database&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fparam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">file_parameters</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;chem&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fparam</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">chem</span> <span class="o">=</span> <span class="n">fparam</span><span class="p">[</span><span class="s1">&#39;chem&#39;</span><span class="p">]</span>
        <span class="n">dbindex</span> <span class="o">=</span> <span class="n">check_chemistry</span><span class="p">(</span><span class="n">chem</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dbindex</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">get_all_parameters</span><span class="p">(</span><span class="n">chem</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">fparam</span><span class="p">,</span> <span class="n">dbindex</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Theory.get_material_parametersOLD"><a class="viewcode-back" href="../developers/CodeCoreCL.html#Theory.Theory.get_material_parametersOLD">[docs]</a>    <span class="k">def</span> <span class="nf">get_material_parametersOLD</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get theory parameters from materials database&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;chem&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">file_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">chem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_dataset</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">file_parameters</span><span class="p">[</span><span class="s1">&#39;chem&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">chem</span> <span class="ow">in</span> <span class="n">materials_user_database</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">materials_user_database</span><span class="p">[</span><span class="n">chem</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">materials_user_database</span><span class="p">[</span><span class="n">chem</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">])</span> 
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">chem</span> <span class="ow">in</span> <span class="n">materials_database</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">materials_database</span><span class="p">[</span><span class="n">chem</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">materials_database</span><span class="p">[</span><span class="n">chem</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">])</span> 
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">RepTate 0.9.7 20200117 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Universidad Polit√©cnica de Madrid, University of Leeds.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.1.
    </div>
  </body>
</html>